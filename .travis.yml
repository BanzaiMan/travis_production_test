dist: trusty
rvm: 2.4.1
cache:
  bundler: true
  directories:
  - vendor/bundle
  - $TRAVIS_BUILD_DIR/tmp/.htmlproofer
addons:
  apt:
    packages:
    - libcurl4-openssl-dev
    - ca-certificates
stages:
  - name: Test
    if: sender != svenfuchs AND sender != imgbot[bot]
  - name: imgbot
    if: sender IN (svenfuchs, imgbot[bot])
  - name: Run build
    if: type IN (push, cron) AND (branch = master OR tag IS present)
jobs:
  include:
    - stage: Run build
      sudo: true
      env:
        NEXT_BUILD_TAG=latest
      script: skip
      deploy:
      - provider: script
        skip-cleanup: true
        script:
        # - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin; docker push acceptbitcoincash/acceptbitcoincash
          docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"; docker push acceptbitcoincash/acceptbitcoincash
        on:
          condition: $NEXT_BUILD_TAG != "latest"
notifications:
  email: false
