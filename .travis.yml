language: minimal
sudo: required
services:
  - docker

env:
  gloal:
    - REPOSITORY="${DOCKER_USERNAME}"
    - BUILD_BASE=""
    - TOOLS_TO_BUILD=""
    - CHANNELS_TO_BUILD=""

script:
  - docker login -u="${DOCKER_USERNAME}" -p="${DOCKER_PASSWORD}"
  - cd compiler && ./build.sh

jobs:
  include:
    - stage: build compiler base
      env: BUILD_BASE="true"

    - stage: build compiler containers
      env: CHANNELS_TO_BUILD="stable"
    - env: CHANNELS_TO_BUILD="beta"
    - env: CHANNELS_TO_BUILD="nightly"

notifications:
  email: false
  # webhooks: http://requestb.in/16le4he1

  #  slack:
  #  rooms:
  #    - secure: "KZTfjxhkOdDDZYD2ThBILt2ShYtdEee3PudFZlQBfpxG9N470GfxnKVfOl7Odu4lN6cIupwC4S4BnehubEywSR99l60VmfhePUCTqDLYy+iR9+guTvaECdXdaau3jTKhFdu5u60ITsiw5Yb+hwAaGFO0HmQhqR9XVr/U8IGQlok="
  #  template:
  #    - "Build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) of %{repository}@%{branch} by %{author} %{result} in %{duration} (elapsed time: %{elapsed_time}) subject: %{commit_subject} message: %{commit_message} foobar"
  #  on_success: always
