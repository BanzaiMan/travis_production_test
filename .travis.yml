language: ruby

dist: trusty

sudo: false

env:
  global:
    - PATH=$HOME/.local/bin:$PATH
    - SHARED_DIR=shared

before_install:
  - pip install --user awscli
  - mkdir -p $SHARED_DIR
  - aws s3 sync s3://travis-build-stages-shared-storage-test/$SHARED_DIR $SHARED_DIR --delete

install: true

jobs:
  include:
    - stage: test
      script: echo hello >> $SHARED_DIR/file1
    - stage: test
      script: echo bar >> $SHARED_DIR/file2
    - stage: deploy
      script: ls -l $SHARED_DIR/*; cat $SHARED_DIR/*

after_success:
  - aws s3 sync $SHARED_DIR s3://travis-build-stages-shared-storage-test/$SHARED_DIR --delete

# env:
#   - DIST=precise STACK=EC2

matrix:
  include:
    - sudo: required
      dist: precise
      env: DIST=precise STACK=GCE
#     - sudo: false
#       dist: trusty
#       env: DIST=trusty STACK=EC2
#     - sudo: required
#       dist: trusty
#       env: DIST=trusty STACK=GCE

# install:
#   - true

# script:
#   - true

notifications:
  email: false
  # webhooks: http://requestb.in/16le4he1

  #  slack:
  #  rooms:
  #    - secure: "KZTfjxhkOdDDZYD2ThBILt2ShYtdEee3PudFZlQBfpxG9N470GfxnKVfOl7Odu4lN6cIupwC4S4BnehubEywSR99l60VmfhePUCTqDLYy+iR9+guTvaECdXdaau3jTKhFdu5u60ITsiw5Yb+hwAaGFO0HmQhqR9XVr/U8IGQlok="
  #  template:
  #    - "Build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) of %{repository}@%{branch} by %{author} %{result} in %{duration} (elapsed time: %{elapsed_time}) subject: %{commit_subject} message: %{commit_message} foobar"
  #  on_success: always
